<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Foro Interactivo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <header class="bg-blue-600 text-white p-4">
    <h1 class="text-2xl font-bold">Foro Interactivo</h1>
  </header>

  <main class="max-w-3xl mx-auto p-4 space-y-6">
    <section>
      <h2 class="text-xl font-semibold mb-2">Haz una pregunta</h2>
      <form id="new-post-form" class="space-y-4">
        <input type="text" id="author" placeholder="Tu nombre o nick" class="w-full p-2 border border-gray-300 rounded" required />
        <textarea id="content" rows="4" placeholder="¿Qué quieres preguntar?" class="w-full p-2 border border-gray-300 rounded resize-y" required></textarea>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Publicar</button>
      </form>
    </section>

    <section>
      <h2 class="text-xl font-semibold mb-4">Preguntas recientes</h2>
      <div id="posts-list" class="space-y-6"></div>
    </section>
  </main>

  <script>
    function cargarPreguntas() {
      const postsList = document.getElementById('posts-list');
      postsList.innerHTML = '';

      let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];

      preguntas.forEach((pregunta, idx) => {
        const article = document.createElement('article');
        article.className = 'bg-white rounded-lg shadow p-6';

        article.innerHTML = `
          <header class="mb-4 flex justify-between items-center">
            <h3 class="text-xl font-semibold" contenteditable="false" id="titulo-${idx}">${pregunta.titulo}</h3>
            <span class="text-sm text-gray-500">por <strong contenteditable="false" id="autor-${idx}">${pregunta.autor}</strong></span>
          </header>
          <p class="mb-4 text-gray-700" contenteditable="false" id="contenido-${idx}">${pregunta.contenido}</p>
          <div class="flex gap-2 mb-2">
            <button class="text-blue-500 text-sm hover:underline editar-pregunta" data-index="${idx}">Editar</button>
            <button class="text-green-600 text-sm hover:underline guardar-pregunta hidden" data-index="${idx}">Guardar</button>
            <button class="text-red-500 text-sm hover:underline eliminar-pregunta" data-index="${idx}">Eliminar</button>
          </div>
          <div class="space-y-4 border-t border-gray-200 pt-4" id="respuestas-${idx}">
            ${pregunta.respuestas ? pregunta.respuestas.map((resp, ridx) => `
              <div class="bg-gray-100 rounded p-3 flex justify-between items-start gap-2">
                <div class="flex-1">
                  <p><strong contenteditable="false" id="resp-autor-${idx}-${ridx}">${resp.autor}</strong>: 
                  <span contenteditable="false" id="resp-texto-${idx}-${ridx}">${resp.texto}</span></p>
                </div>
                <div class="text-xs text-right space-y-1">
                  <button class="text-blue-400 hover:underline editar-respuesta" data-pindex="${idx}" data-rindex="${ridx}">Editar</button>
                  <button class="text-green-500 hover:underline guardar-respuesta hidden" data-pindex="${idx}" data-rindex="${ridx}">Guardar</button>
                  <button class="text-red-400 hover:underline eliminar-respuesta" data-pindex="${idx}" data-rindex="${ridx}">Eliminar</button>
                </div>
              </div>
            `).join('') : ''}
            <form class="mt-4 space-y-2 respuesta-form" data-index="${idx}">
              <input type="text" placeholder="Tu nombre o nick" class="w-full p-2 border border-gray-300 rounded" required />
              <textarea rows="2" placeholder="Escribe tu respuesta..." class="w-full p-2 border border-gray-300 rounded resize-y" required></textarea>
              <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Responder</button>
            </form>
          </div>
        `;

        postsList.appendChild(article);
      });

      document.querySelectorAll('.respuesta-form').forEach(form => {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          const idx = this.dataset.index;
          const nombre = this.querySelector('input').value.trim();
          const texto = this.querySelector('textarea').value.trim();
          if (!nombre || !texto) {
            alert('Por favor completa ambos campos para responder.');
            return;
          }

          let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
          if (!preguntas[idx].respuestas) {
            preguntas[idx].respuestas = [];
          }
          preguntas[idx].respuestas.push({ autor: nombre, texto: texto });
          localStorage.setItem('preguntas', JSON.stringify(preguntas));
          cargarPreguntas();
        });
      });

      document.querySelectorAll('.eliminar-pregunta').forEach(btn => {
        btn.addEventListener('click', function () {
          const idx = this.dataset.index;
          if (confirm('¿Estás seguro de que quieres eliminar esta pregunta?')) {
            let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
            preguntas.splice(idx, 1);
            localStorage.setItem('preguntas', JSON.stringify(preguntas));
            cargarPreguntas();
          }
        });
      });

      document.querySelectorAll('.editar-pregunta').forEach(btn => {
        btn.addEventListener('click', function () {
          const idx = this.dataset.index;
          document.getElementById(`titulo-${idx}`).contentEditable = true;
          document.getElementById(`autor-${idx}`).contentEditable = true;
          document.getElementById(`contenido-${idx}`).contentEditable = true;
          this.classList.add('hidden');
          document.querySelector(`.guardar-pregunta[data-index="${idx}"]`).classList.remove('hidden');
        });
      });

      document.querySelectorAll('.guardar-pregunta').forEach(btn => {
        btn.addEventListener('click', function () {
          const idx = this.dataset.index;
          const titulo = document.getElementById(`titulo-${idx}`).innerText.trim();
          const autor = document.getElementById(`autor-${idx}`).innerText.trim();
          const contenido = document.getElementById(`contenido-${idx}`).innerText.trim();
          let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
          preguntas[idx].titulo = titulo;
          preguntas[idx].autor = autor;
          preguntas[idx].contenido = contenido;
          localStorage.setItem('preguntas', JSON.stringify(preguntas));
          cargarPreguntas();
        });
      });

      document.querySelectorAll('.eliminar-respuesta').forEach(btn => {
        btn.addEventListener('click', function () {
          const pidx = this.dataset.pindex;
          const ridx = this.dataset.rindex;
          if (confirm('¿Eliminar esta respuesta?')) {
            let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
            preguntas[pidx].respuestas.splice(ridx, 1);
            localStorage.setItem('preguntas', JSON.stringify(preguntas));
            cargarPreguntas();
          }
        });
      });

      document.querySelectorAll('.editar-respuesta').forEach(btn => {
        btn.addEventListener('click', function () {
          const pidx = this.dataset.pindex;
          const ridx = this.dataset.rindex;
          document.getElementById(`resp-autor-${pidx}-${ridx}`).contentEditable = true;
          document.getElementById(`resp-texto-${pidx}-${ridx}`).contentEditable = true;
          this.classList.add('hidden');
          document.querySelector(`.guardar-respuesta[data-pindex="${pidx}"][data-rindex="${ridx}"]`).classList.remove('hidden');
        });
      });

      document.querySelectorAll('.guardar-respuesta').forEach(btn => {
        btn.addEventListener('click', function () {
          const pidx = this.dataset.pindex;
          const ridx = this.dataset.rindex;
          const autor = document.getElementById(`resp-autor-${pidx}-${ridx}`).innerText.trim();
          const texto = document.getElementById(`resp-texto-${pidx}-${ridx}`).innerText.trim();
          let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
          preguntas[pidx].respuestas[ridx].autor = autor;
          preguntas[pidx].respuestas[ridx].texto = texto;
          localStorage.setItem('preguntas', JSON.stringify(preguntas));
          cargarPreguntas();
        });
      });
    }

    cargarPreguntas();

    document.getElementById('new-post-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const autor = this.querySelector('#author').value.trim();
      const contenido = this.querySelector('#content').value.trim();
      if (!autor || !contenido) {
        alert('Por favor completa todos los campos.');
        return;
      }

      let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
      preguntas.unshift({
        titulo: contenido.length > 50 ? contenido.substring(0, 50) + '...' : contenido,
        autor: autor,
        contenido: contenido,
        respuestas: []
      });
      localStorage.setItem('preguntas', JSON.stringify(preguntas));

      this.reset();
      cargarPreguntas();
    });
  </script>
</body>
</html>

